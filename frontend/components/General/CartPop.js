import React, { useContext } from 'react';
import styled from 'styled-components';
import { Mutation } from 'react-apollo';
import { TOGGLE_CART_MUTATION } from '../General/Cart';
import { Me } from '../Middleware';

const Cart = styled.span`
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  background: ${({ theme }) => theme.color.primary};
  border-radius: 2em;
  padding: 15px;
  height: 4em;
  width: 4em;
  cursor: pointer;
  right: 20px;
  top: 20px;
  box-shadow: 0px 0px 5px 0px rgba(244, 123, 81, 0.55), 0px 4px 5px 0px rgba(0, 0, 0, 0.1),
    0px 0px 10px 0px rgba(244, 123, 81, 0.7);
  transition: all 0.1s;

  ${({ theme }) => theme.media.tablet`
    background: linear-gradient(145deg, #ff8457, #dd6f49);
    box-shadow:  5px 5px 10px #da6d48, 
                -5px -5px 10px #ff895a;
  `}

  svg {
    width: 80%;
    path {
      fill: ${({ theme }) => theme.color.white};
    }
  }
  p {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    color: ${({ theme }) => theme.color.white};
  }
  &:hover {
    transform: scale(1.1);
    box-shadow: 0px 0px 20px 0px rgba(244, 123, 81, 0.55), 0px 4px 5px 0px rgba(0, 0, 0, 0.1),
      0px 0px 10px 0px rgba(244, 123, 81, 0.7);
  }

  &:after {
    content: attr(data-items);
    position: absolute;
    /* right: 0; */
    /* top: ${({ cartItems }) => cartItems}; */
    transform: translateY(5px);
    color: ${({ theme }) => theme.color.white};
  }
`;

const CartPop = () => {
  const User = useContext(Me);
  return (
    <Mutation mutation={TOGGLE_CART_MUTATION}>
      {toggleCart => (
        <Cart onClick={toggleCart} data-items={User.info.cart.length}>
          <svg viewBox="0 0 28 37" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M15.3889 0.00104687C14.9868 0.00519236 14.5855 0.0499861 14.1917 0.132896C10.9325 -0.559401 7.73051 1.52162 7.03738 4.77997C6.95033 5.19203 6.90555 5.61238 6.90555 6.03356V8.13783H2.05285C0.918641 8.13866 -0.000828537 9.05811 5.60266e-07 10.1931V34.4285C5.60266e-07 35.5619 0.91947 36.4813 2.05285 36.4822H25.1714C26.3056 36.4813 27.2242 35.5627 27.2242 34.4285V10.1931C27.2251 9.05894 26.3064 8.13866 25.1714 8.13783H21.4753V6.03356C21.4753 2.70142 18.7757 0.00104687 15.4444 0.00104687C15.4262 0.00104687 15.4071 0.00104687 15.3889 0.00104687ZM12.7076 0.657711C10.6854 1.68745 9.41192 3.76432 9.41192 6.03356V8.13783H7.55805V6.03356C7.55723 3.15162 9.82812 0.781247 12.7076 0.657711ZM15.6733 0.657711C18.5535 0.780417 20.8244 3.15079 20.8244 6.03356V8.13783H18.9706V6.03356C18.9706 3.76432 17.6963 1.68745 15.6733 0.657711ZM14.1908 0.801148C16.611 1.38152 18.3173 3.54544 18.3173 6.03356V8.13783H10.0644V6.03356C10.0644 3.54461 11.7707 1.38152 14.1908 0.801148ZM2.05285 8.79032H3.95977C3.87437 8.95697 3.8296 9.14185 3.8296 9.32923V9.37733C3.8238 10.2562 3.10746 10.9634 2.22944 10.9576C1.52139 10.9534 0.90123 10.4809 0.709708 9.79934C0.883819 9.20156 1.43102 8.79115 2.05285 8.79032ZM5.02267 8.79032H9.41109V11.2046C8.55878 11.3846 8.01323 12.2219 8.19397 13.0743C8.37389 13.9266 9.21127 14.4721 10.0636 14.2922C10.9159 14.1123 11.4614 13.2749 11.2807 12.4226C11.1522 11.8116 10.6746 11.334 10.0636 11.2046V8.79032H20.8244V11.2046C19.973 11.3846 19.4266 12.2211 19.6065 13.0743C19.7864 13.9266 20.623 14.473 21.4753 14.293C22.3284 14.1131 22.874 13.2757 22.6941 12.4234C22.5655 11.8115 22.088 11.334 21.4753 11.2046V8.79032H25.1714C25.9458 8.79115 26.5717 9.41959 26.5717 10.1931V34.4285C26.5717 35.2029 25.945 35.8297 25.1714 35.8305H5.02267C4.72503 35.8313 4.48376 35.5909 4.48376 35.2933C4.48376 35.2933 4.48376 35.2924 4.48376 35.2916V9.33006C4.48376 9.03325 4.7242 8.79116 5.02102 8.79116C5.02184 8.79033 5.02267 8.79032 5.02267 8.79032ZM0.650013 10.9559C1.52305 11.8339 2.94164 11.8381 3.81965 10.9659C3.82297 10.9626 3.82629 10.9592 3.8296 10.9559V35.2908C3.8296 35.479 3.87437 35.663 3.95977 35.8297H2.05285C1.27764 35.8305 0.650013 35.2029 0.650013 34.4277V10.9559ZM21.1337 11.8116C21.6453 11.8024 22.0673 12.2095 22.0764 12.7219C22.0764 12.731 22.0764 12.7393 22.0764 12.7484C22.0863 13.26 21.6792 13.6828 21.1677 13.6928C20.6561 13.7027 20.2333 13.2956 20.2233 12.7841C20.2233 12.7725 20.2233 12.7609 20.2233 12.7484C20.2184 12.2394 20.6246 11.8215 21.1337 11.8116ZM9.71039 11.8248C10.2219 11.8091 10.6489 12.2112 10.6639 12.7227C10.6639 12.7319 10.6639 12.741 10.6639 12.7501C10.6639 13.2616 10.2493 13.677 9.73692 13.677C9.22454 13.677 8.80999 13.2616 8.80999 12.7501C8.81082 12.2485 9.20962 11.8389 9.71039 11.8248Z"
              fill="white"
            />
          </svg>
          {/* <p>
          <User>{({ data: { me }, loading }) => (me ? me.cart.length : 0)}</User>
        </p> */}
        </Cart>
      )}
    </Mutation>
  );
};

export default CartPop;
